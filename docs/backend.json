{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the Pixel Emporium e-commerce store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "price": {
          "type": "number",
          "description": "The price of the product."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "brand": {
          "type": "string",
          "description": "The brand of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "stockQuantity": {
          "type": "number",
          "description": "The number of items currently in stock."
        },
        "averageRating": {
          "type": "number",
          "description": "The average rating of the product based on user reviews."
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "description",
        "categoryId",
        "brand",
        "imageUrl",
        "stockQuantity"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a product category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the category."
        },
        "description": {
          "type": "string",
          "description": "A description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Pixel Emporium e-commerce store. (Authentication data is handled by Firebase).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The phone number of the user."
        },
        "addressId": {
          "type": "string",
          "description": "Reference to Address. (Relationship: User 1:1 Address)"
        }
      },
      "required": [
        "id",
        "fullName",
        "email",
        "phoneNumber",
        "addressId"
      ]
    },
    "Address": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Address",
      "type": "object",
      "description": "Represents an address associated with a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Address entity."
        },
        "street": {
          "type": "string",
          "description": "The street address."
        },
        "city": {
          "type": "string",
          "description": "The city of the address."
        },
        "state": {
          "type": "string",
          "description": "The state of the address."
        },
        "zipCode": {
          "type": "string",
          "description": "The zip code of the address."
        },
        "country": {
          "type": "string",
          "description": "The country of the address."
        }
      },
      "required": [
        "id",
        "street",
        "city",
        "state",
        "zipCode",
        "country"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Order entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "The date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "shippingAddressId": {
          "type": "string",
          "description": "Reference to Address. (Relationship: Order 1:1 Address)"
        },
        "paymentMethod": {
          "type": "string",
          "description": "The payment method used for the order."
        },
        "orderItemIds": {
          "type": "array",
          "description": "References to OrderItems. (Relationship: Order 1:N OrderItem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "shippingAddressId",
        "paymentMethod",
        "orderItemIds"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item in an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the OrderItem entity."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the product in the order item."
        },
        "pricePerUnit": {
          "type": "number",
          "description": "The price of the product per unit at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "pricePerUnit"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item in the user's shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CartItem entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CartItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N CartItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the product in the cart."
        }
      },
      "required": [
        "id",
        "userId",
        "productId",
        "quantity"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review for a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Review entity."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Review)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "The rating given by the user."
        },
        "comment": {
          "type": "string",
          "description": "The comment written by the user."
        },
        "reviewDate": {
          "type": "string",
          "description": "The date the review was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "userId",
        "rating",
        "comment",
        "reviewDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Authentication handled by Firebase Auth.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Matches the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/addresses/{addressId}",
        "definition": {
          "entityName": "Address",
          "schema": {
            "$ref": "#/backend/entities/Address"
          },
          "description": "Stores user addresses. Accessed only by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Matches the Firebase Auth UID."
            },
            {
              "name": "addressId",
              "description": "The unique identifier for the address."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Matches the Firebase Auth UID."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores order item information for a specific order.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Matches the Firebase Auth UID."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cartItems/{cartItemId}",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "Stores cart items for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user. Matches the Firebase Auth UID."
            },
            {
              "name": "cartItemId",
              "description": "The unique identifier for the cart item."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores product reviews. Includes denormalized 'productId' and 'userId' for authorization independence.",
          "params": [
            {
              "name": "reviewId",
              "description": "The unique identifier for the review."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Pixel Emporium e-commerce application, focusing on user authentication and product management. It leverages Firebase Authentication for user creation and authentication, storing user profile data in Firestore. Products and categories are stored in separate collections to enable efficient querying and filtering. Orders, OrderItems and CartItems are stored in subcollections under the user's document, which enables the correct QAPs. Reviews are stored in a collection with the productId and userId denormalized to guarantee Authorization Independence. Addresses are stored in a subcollection under the user document. The structure prioritizes security, scalability, and ease of debugging, with a focus on Authorization Independence by denormalizing authorization-related data (like user IDs for reviews) to avoid `get()` calls in security rules.\n\nThe segregation of public product and category data from user-specific data (orders, cart items, reviews) ensures a homogeneous security posture within each collection. Path-based ownership is employed for user-owned data (e.g., orders under `/users/{userId}/orders/{orderId}`), simplifying security rules. Global roles can be managed via dedicated collections (e.g., `/roles_admin/{uid}`)."
  }
}